# 基礎編外のコード
## map
配列要素に対して使えるJSに標準搭載されているメソッドでループ文の一種のようなもの  
mapを配列に使用した時の処理は以下
1. 配列の要素数だけループ文が実行される
2. 1ループごとに配列の現在要素と現在のindex値の引数を取る
-> サンプルでは("Select 1", 0) -> ("Select 2", 1)...のようになる
3. コンポーネントにkey属性を付与する
-> Reactに「この要素はこのページ内に1個しかないt」と伝えている

3が必要になるのはReactにどのデータが変更されたかをはっきり見分けさせるため
``` jsx
// jsxファイル
quizData[quizIndex].options.map((option, index) => {
  return <Button key={`option-${index}`}>{option}</Button>;
})

// jsに記載した配列
const quizData = [
	{
		question: "Question 1",
		options: ["Select 1", "Select 2", "Select 3", "Select 4"],
		answerIndex: 0
	},
}
```

## 関数型更新とスプレッド更新
``` jsx
export default function QuizPage() {
	const [quizIndex, setQuizIndex] = useState(0);
	const [answerLogs, setAnswerLogs] = useState([]);
	const handleClick = (clickedIndex) => {
		if (clickedIndex === quizData[quizIndex].answerIndex) {
			setAnswerLogs((prev) => [...prev, true])
		} else {
			setAnswerLogs((prev) => [...prev, false])
		}

		setQuizIndex((prev) => prev + 1);
	}
	return (
		<>
			<Display>
				{`Q1. ${quizData[quizIndex].question}`}
			</Display>
			{
				quizData[quizIndex].options.map((option, index) => {
					return (
						<Button key={`option-${index}`} onClick={() => handleClick(index)}>
							{option}
						</Button>
					);
				})
			}
		</>
	)
}
```
### 関数型更新
setQuizIndex((prev) => prev + 1)は次の問題へ進むための処理で、「現在のquizIndexに1足して保存する」という処理  
**useStateのset関数は現在のstate変数を引数として受け取れる仕様がある**  
※ 引数名はprev(Previous)でなくてもよいが、ほぼ現在の値を更新したり、追加して最新の値を保存する場合の処理を書く  
-> 最新の値になる = 現在の値は古くなるから、慣習的にprevに名づけることが多い  
また、setQuizIndex(prev + 1)と書くのはバグの原因になるからNG  
以下のようにsetQuizIndexを2回実行させようとした場合でも、Reactがまとめて1回の処理とすることがある  
-> prev + 1が意図せず1回しか実行されない可能性がある  
まとめて処理するのはReactの特徴で、パフォーマンスが高い理由の1つでもあるが...  
setQuizIndex((prev) => prev + 1)のような更新の仕方を**Reactでは関数型更新(Functional Update)という**
``` jsx
// OK
setQuizIndex((prev) => prev + 1); //0が入ってきて1として保存
setQuizIndex((prev) => prev + 1); //1が入ってきて2で保存という処理が確実に行われる

-- NG
setQuizIndex(prev + 1);
setQuizIndex(prev + 1);
```

### スプレッド更新
setAnswerLogs((prev) => [...prev, true(false)])は、setAnswerLogsのstate変数の配列を取ってきて、新しい要素としてtrue(false)を追加している
「...prev」のドットが3つ続く部分をスプレッド構文と呼ぶ  
スプレッド構文は様々な用途があるため、今回のケースのみの説明  
ざっくりと簡単な書き方で配列に要素を追加できる
以前は配列の要素を追加するにはpush()を使っていたが、スプレッド構文で簡単に要素を追加できる
[TypeScriptドキュメント](https://typescriptbook.jp/reference/values-types-variables/array/spread-syntax-for-array)
```js
// 以前
const arr = [1, 2, 3];
const arr2 = [];
for (const item of arr) {
  arr2.push(item);
}
arr2.push(4);

// スプレッド構文
const arr = [1, 2, 3];
const arr2 = [...arr, 4];
```
